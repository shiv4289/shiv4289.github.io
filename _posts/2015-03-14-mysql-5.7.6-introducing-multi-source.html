---
layout: post
title: MySQL-5.7.6: Introducing Multi-source replication
date: 2015-03-14
comments: true
categories:
- mysql
tags:
- mysql
- multi-source
---


<div dir="ltr" style="text-align: left;" trbidi="on">
<div style="color: #141412; font-family: 'Source Sans Pro', Helvetica, sans-serif; font-size: 16px; line-height: 24px; margin-bottom: 24px;">
<a data-mce-href="http://mysqlserverteam.com/the-mysql-5-7-6-milestone-release-is-available/" href="http://mysqlserverteam.com/the-mysql-5-7-6-milestone-release-is-available/" style="color: #ac0404; text-decoration: none;">On</a>&nbsp;<a data-mce-href="http://mysqlserverteam.com/the-mysql-5-7-6-milestone-release-is-available/" href="http://mysqlserverteam.com/the-mysql-5-7-6-milestone-release-is-available/" style="color: #ac0404; text-decoration: none;">March</a><a data-mce-href="http://mysqlserverteam.com/the-mysql-5-7-6-milestone-release-is-available/" href="http://mysqlserverteam.com/the-mysql-5-7-6-milestone-release-is-available/" style="color: #ac0404; text-decoration: none;">&nbsp;10, 2015,&nbsp;</a><a data-mce-href="http://mysqlserverteam.com/the-mysql-5-7-6-milestone-release-is-available/" href="http://mysqlserverteam.com/the-mysql-5-7-6-milestone-release-is-available/" style="color: #ac0404; text-decoration: none;">we</a>&nbsp;<a data-mce-href="http://mysqlserverteam.com/the-mysql-5-7-6-milestone-release-is-available/" href="http://mysqlserverteam.com/the-mysql-5-7-6-milestone-release-is-available/" style="color: #ac0404; text-decoration: none;">released</a>&nbsp;<a data-mce-href="http://mysqlserverteam.com/the-mysql-5-7-6-milestone-release-is-available/" href="http://mysqlserverteam.com/the-mysql-5-7-6-milestone-release-is-available/" style="color: #ac0404; text-decoration: none;">MySQL</a><a data-mce-href="http://mysqlserverteam.com/the-mysql-5-7-6-milestone-release-is-available/" href="http://mysqlserverteam.com/the-mysql-5-7-6-milestone-release-is-available/" style="color: #ac0404; text-decoration: none;">-5.7.6</a>&nbsp;and among many other things it includes&nbsp;<a data-mce-href="http://dev.mysql.com/doc/refman/5.7/en/replication-multi-source-overview.html" href="http://dev.mysql.com/doc/refman/5.7/en/replication-multi-source-overview.html" style="color: #ac0404; text-decoration: none;">multi-source replication</a>&nbsp;which provides the ability for a MySQL slave server to replicate from more than one MySQL master. We have been very careful with multi-source replication in terms of what exactly our users want and we have tried our best to incorporate as much feedback as possible. In the process, we released the feature twice under&nbsp;<a data-mce-href="http://labs.mysql.com/" href="http://labs.mysql.com/" style="color: #ac0404; text-decoration: none;">MySQL</a>&nbsp;<a data-mce-href="http://labs.mysql.com/" href="http://labs.mysql.com/" style="color: #ac0404; text-decoration: none;">Labs</a>&nbsp;asking users to try it out and tell us:</div>
<ol style="color: #141412; font-family: 'Source Sans Pro', Helvetica, sans-serif; font-size: 16px; line-height: 24px; list-style-position: outside; margin: 16px 0px; padding: 0px 0px 0px 40px;">
<li>If this caters to all their use cases,</li>
<li>Plays well with the existing applications using single source replication so our users don’t have to change their old scripts at all if they do not intend to use multi-source and instead stick to single source replication.</li>
<li>The user interface is in sync with our naming conventions to date, easy to understand and intuitive etc.</li>
</ol>
<div style="color: #141412; font-family: 'Source Sans Pro', Helvetica, sans-serif; font-size: 16px; line-height: 24px; margin-bottom: 24px;">
Note that the look and feel changed as we moved from one lab release to another and finally to the latest version as MySQL-5.7.6. In this post, I aim to introduce the released feature, the commands and how you can monitor the multi-source replication internals. Let's start with the following figure that best illustrates the core of multi-source replication.</div>
<div style="color: #141412; font-family: 'Source Sans Pro', Helvetica, sans-serif; font-size: 16px; line-height: 24px; margin-bottom: 24px;">
<a data-mce-href="http://mysqlhighavailability.com/wp-content/uploads/2015/03/multi-source-basic.png" href="http://mysqlhighavailability.com/wp-content/uploads/2015/03/multi-source-basic.png" style="color: #ac0404; text-decoration: none;"><img alt="multi-source-basic" class="aligncenter wp-image-570 size-full" data-mce-src="http://mysqlhighavailability.com/wp-content/uploads/2015/03/multi-source-basic.png" src="http://mysqlhighavailability.com/wp-content/uploads/2015/03/multi-source-basic.png" height="286" style="display: block; height: auto; margin: 5px auto; max-width: 100%; vertical-align: middle;" width="416" /></a></div>
<div style="color: #141412; font-family: 'Source Sans Pro', Helvetica, sans-serif; font-size: 16px; line-height: 24px; margin-bottom: 24px;">
In the figure above we have three MySQL sources (independent MySQL servers- master 1, master 2 and master 3) replicating to the only slave acting as a sink to collect all the data from all the three sources.</div>
<div style="color: #141412; font-family: 'Source Sans Pro', Helvetica, sans-serif; font-size: 16px; line-height: 24px; margin-bottom: 24px;">
The use cases of multi-source, as you have probably already guessed, are related to data aggregation. Note that there is no conflict detection or resolution built into multi-source replication. We expect the application to make sure that data coming from different sources are non-conflicting. A typical setup could be something like this:</div>
<div style="color: #141412; font-family: 'Source Sans Pro', Helvetica, sans-serif; font-size: 16px; line-height: 24px; margin-bottom: 24px;">
<a data-mce-href="http://mysqlhighavailability.com/wp-content/uploads/2015/03/multi-source-with-databases.png" href="http://mysqlhighavailability.com/wp-content/uploads/2015/03/multi-source-with-databases.png" style="color: #ac0404; text-decoration: none;"><img alt="multi-source-with-databases" class="aligncenter wp-image-571 size-full" data-mce-src="http://mysqlhighavailability.com/wp-content/uploads/2015/03/multi-source-with-databases.png" src="http://mysqlhighavailability.com/wp-content/uploads/2015/03/multi-source-with-databases.png" height="293" style="display: block; height: auto; margin: 5px auto; max-width: 100%; vertical-align: middle;" width="645" /></a></div>
<div style="color: #141412; font-family: 'Source Sans Pro', Helvetica, sans-serif; font-size: 16px; line-height: 24px; margin-bottom: 24px;">
</div>
<div style="color: #141412; font-family: 'Source Sans Pro', Helvetica, sans-serif; font-size: 16px; line-height: 24px; margin-bottom: 24px;">
The same concept could be extended to shards (instead of databases). So another use case of multi-source replication is to join shards and make a full table on the sink (aka slave). .</div>
<div style="color: #141412; font-family: 'Source Sans Pro', Helvetica, sans-serif; font-size: 16px; line-height: 24px; margin-bottom: 24px;">
To understand how to configure and monitor multi-source replication, we introduced the notion of channels. A channel is an abstraction of the internals of MySQL replication's finer details. It hides the machinery underneath while providing the level of detail that helps the user manage and understand multi-source replication. From a user perspective you can imagine a channel as a pipe between a master and a slave. If there are multiple masters, there are the same number of channels (or pipes) emerging out of the slave server as the number of sources as shown in the picture below:</div>
<div style="color: #141412; font-family: 'Source Sans Pro', Helvetica, sans-serif; font-size: 16px; line-height: 24px; margin-bottom: 24px;">
<a data-mce-href="http://mysqlhighavailability.com/wp-content/uploads/2015/03/multiple-channels.png" href="http://mysqlhighavailability.com/wp-content/uploads/2015/03/multiple-channels.png" style="color: #ac0404; text-decoration: none;"><img alt="multiple-channels" class="aligncenter wp-image-572 size-full" data-mce-src="http://mysqlhighavailability.com/wp-content/uploads/2015/03/multiple-channels.png" src="http://mysqlhighavailability.com/wp-content/uploads/2015/03/multiple-channels.png" height="282" style="display: block; height: auto; margin: 5px auto; max-width: 100%; vertical-align: middle;" width="807" /></a></div>
<div style="color: #141412; font-family: 'Source Sans Pro', Helvetica, sans-serif; font-size: 16px; line-height: 24px; margin-bottom: 24px;">
</div>
<div style="color: #141412; font-family: 'Source Sans Pro', Helvetica, sans-serif; font-size: 16px; line-height: 24px; margin-bottom: 24px;">
If you understand MySQL internals already and want to know exactly what constitutes a channel, look at the pink strip in the following picture. The&nbsp;<a data-mce-href="http://dev.mysql.com/doc/refman/5.7/en/replication-channels.html" href="http://dev.mysql.com/doc/refman/5.7/en/replication-channels.html" style="color: #ac0404; text-decoration: none;">replication channel documentation</a>&nbsp;has all the details. But if you don’t know these details already, ignore this figure and move ahead. After all that is what we wanted to achieve with the concept of a channel.</div>
<div style="color: #141412; font-family: 'Source Sans Pro', Helvetica, sans-serif; font-size: 16px; line-height: 24px; margin-bottom: 24px;">
<a data-mce-href="http://mysqlhighavailability.com/wp-content/uploads/2015/03/channel.png" href="http://mysqlhighavailability.com/wp-content/uploads/2015/03/channel.png" style="color: #ac0404; text-decoration: none;"><img alt="channel" class="aligncenter wp-image-569 size-full" data-mce-src="http://mysqlhighavailability.com/wp-content/uploads/2015/03/channel.png" src="http://mysqlhighavailability.com/wp-content/uploads/2015/03/channel.png" height="283" style="display: block; height: auto; margin: 5px auto; max-width: 100%; vertical-align: middle;" width="812" /></a></div>
<div style="color: #141412; font-family: 'Source Sans Pro', Helvetica, sans-serif; font-size: 16px; line-height: 24px; margin-bottom: 24px;">
</div>
<div style="color: #141412; font-family: 'Source Sans Pro', Helvetica, sans-serif; font-size: 16px; line-height: 24px; margin-bottom: 24px;">
With the concept of channels established, you can now follow steps described in the&nbsp;<a data-mce-href="http://dev.mysql.com/doc/refman/5.7/en/replication-multi-source-tutorials.html" href="http://dev.mysql.com/doc/refman/5.7/en/replication-multi-source-tutorials.html" style="color: #ac0404; text-decoration: none;">tutorial section of our official documentation</a>&nbsp;to work with multi-source replication. Note how the FOR CHANNEL &lt;channel_name&gt; clause now allows you to take each master-slave instance individually and work with them as if you were working with a single source replication topology.</div>
<div style="color: #141412; font-family: 'Source Sans Pro', Helvetica, sans-serif; font-size: 16px; line-height: 24px; margin-bottom: 24px;">
Having set up multi-source replication and making sure there are no conflicts you can expect it to just work out of the box. But if you want more details you could look at our monitoring interfaces to provide you the details on every channel.<a data-mce-href="http://work.shivjijha.com/2013/09/Introducing-the-performance-schema-tables-to-monitor-MySQL-replication.html" href="http://work.shivjijha.com/2013/09/Introducing-the-performance-schema-tables-to-monitor-MySQL-replication.html" style="color: #ac0404; text-decoration: none;">&nbsp;In MySQL-5.7.2, we introduced performance_schema tables to monitor replication</a>, the good news is that these tables were always designed with multi-source replication in mind so they should work seamlessly with multi-source replication. All six replication performance schema tables now have a “channel_name” field added to them to individually access the configuration and status on each channel. As an example,&nbsp;<a data-mce-href="http://dev.mysql.com/doc/refman/5.7/en/replication-multi-source-monitoring.html" href="http://dev.mysql.com/doc/refman/5.7/en/replication-multi-source-monitoring.html" style="color: #ac0404; text-decoration: none;">we have described performance_schema.replication_connection status in our manual</a>. Given that you are working with multiple channels, lets walk through this table again and see how it presents the internals. Try out the following query to look at the receiver module:</div>
<div style="color: #141412; font-family: 'Source Sans Pro', Helvetica, sans-serif; font-size: 16px; line-height: 24px; margin-bottom: 24px;">
<a data-mce-href="http://mysqlhighavailability.com/wp-content/uploads/2015/03/ps-table3.png" href="http://mysqlhighavailability.com/wp-content/uploads/2015/03/ps-table3.png" style="color: #ac0404; text-decoration: none;"><img alt="ps-table3" class="aligncenter wp-image-574 size-full" data-mce-src="http://mysqlhighavailability.com/wp-content/uploads/2015/03/ps-table3.png" src="http://mysqlhighavailability.com/wp-content/uploads/2015/03/ps-table3.png" height="324" style="display: block; height: auto; margin: 5px auto; max-width: 100%; vertical-align: middle;" width="702" /></a></div>
<div style="color: #141412; font-family: 'Source Sans Pro', Helvetica, sans-serif; font-size: 16px; line-height: 24px; margin-bottom: 24px;">
We can see quite a few things here:</div>
<ol style="color: #141412; font-family: 'Source Sans Pro', Helvetica, sans-serif; font-size: 16px; line-height: 24px; list-style-position: outside; margin: 16px 0px; padding: 0px 0px 0px 40px;">
<li>Which master does channel1 replicate from?<br />The one whose UUID is as given in the “source_uuid” column.</li>
<li>Which thread is responsible for receiving transaction through channel1?<br /><span data-mce-style="line-height: 1.5;" style="line-height: 1.5;">Thread number 13. Note that this thread number is same as the one in&nbsp;</span><a data-mce-href="http://dev.mysql.com/doc/refman/5.7/en/threads-table.html" href="http://dev.mysql.com/doc/refman/5.7/en/threads-table.html" style="color: #ac0404; text-decoration: none;">performance_schema.threads table</a>. You can use this information to now&nbsp;look into other performance_schema tables to mine more statistics using&nbsp;the joins.</li>
<li>Is the receiver module of channel1 active or down at the moment?<br />The channel is active and receiving transactions because its service state is ON.</li>
<li>What transactions have been received via channel1?<br />Transactions 1-4. See the global transaction identifiers in the field "received_transaction_set".</li>
<li>What if there was an error?<br />The last three fields in each row give an idea of the error on that channel, if any.<br />See &nbsp;the example below where channel1 has lost connection:<br /><a data-mce-href="http://mysqlhighavailability.com/wp-content/uploads/2015/03/ps-table4.png" href="http://mysqlhighavailability.com/wp-content/uploads/2015/03/ps-table4.png" style="color: #ac0404; text-decoration: none;"><img alt="ps-table4" class="alignnone wp-image-575 size-full" data-mce-src="http://mysqlhighavailability.com/wp-content/uploads/2015/03/ps-table4.png" src="http://mysqlhighavailability.com/wp-content/uploads/2015/03/ps-table4.png" height="311" style="height: auto; margin: 5px 0px; max-width: 100%; vertical-align: middle;" width="766" /></a></li>
<li><div align="left" style="margin-bottom: 24px;">
How about my network?<br />
Look at the last two columns to get an idea of this. The last time a heartbeat signal&nbsp;was sent is shown in the “last_heartbeat_timestamp” column.<br />
The "count_received_heartbeat" indicates how frequently heartbeats are being sent out.&nbsp;A big number here would mean that either the connection is not stable or this&nbsp;channel was idle having nothing to replicate.</div>
</li>
</ol>
<div style="color: #141412; font-family: 'Source Sans Pro', Helvetica, sans-serif; font-size: 16px; line-height: 24px; margin-bottom: 24px;">
Likewise there are more replication performance_schema tables that you can use to get to finer details. If there is anything else that you think should be available in these tables per channel, leave us a comment and we would be happy to take it forward. We truly believe in working with our users and look forward to your experience with this feature. There is a lot more to explore in multi-source replication so&nbsp;<a data-mce-href="http://dev.mysql.com/downloads/mysql/5.7.html#downloads" href="http://dev.mysql.com/downloads/mysql/5.7.html#downloads" style="color: #ac0404; text-decoration: none;">go try out the feature</a>&nbsp;and if there is anything that you have suggestions for, please do leave a comment. Don't forget<span data-mce-style="color: #141412;"><span data-mce-style="font-family: Arial;" style="font-family: Arial;"><span data-mce-style="font-size: medium;" style="font-size: small;">&nbsp;that MySQL 5.7.6 is a&nbsp;</span></span></span><a data-mce-href="http://dev.mysql.com/doc/mysql-development-cycle/en/development-milestone-releases.html" href="http://dev.mysql.com/doc/mysql-development-cycle/en/development-milestone-releases.html" style="color: #ac0404; text-decoration: none;"><span data-mce-style="color: #1155cc;" style="color: #1155cc;"><span data-mce-style="font-family: Arial;" style="font-family: Arial;"><span data-mce-style="font-size: medium;" style="font-size: small;"><span data-mce-style="text-decoration: underline;" style="text-decoration: underline;">development milestone release (DMR)</span></span></span></span></a><span data-mce-style="color: #141412;"><span data-mce-style="font-family: Arial;" style="font-family: Arial;"><span data-mce-style="font-size: medium;" style="font-size: small;">,&nbsp;</span></span></span><span data-mce-style="color: #141412;"><span data-mce-style="font-family: Arial;" style="font-family: Arial;"><span data-mce-style="font-size: medium;" style="font-size: small;">and therefore</span></span></span><span data-mce-style="color: #141412;"><span data-mce-style="font-family: Arial;" style="font-family: Arial;"><span data-mce-style="font-size: medium;" style="font-size: small;">&nbsp;not yet declared&nbsp;</span></span></span><a data-mce-href="http://dev.mysql.com/doc/mysql-development-cycle/en/ga-releases.html" href="http://dev.mysql.com/doc/mysql-development-cycle/en/ga-releases.html" style="color: #ac0404; text-decoration: none;"><span data-mce-style="color: #1155cc;" style="color: #1155cc;"><span data-mce-style="font-family: Arial;" style="font-family: Arial;"><span data-mce-style="font-size: medium;" style="font-size: small;"><span data-mce-style="text-decoration: underline;" style="text-decoration: underline;">generally available</span></span></span></span></a><span data-mce-style="color: #141412;"><span data-mce-style="font-family: Arial;" style="font-family: Arial;"><span data-mce-style="font-size: medium;" style="font-size: small;">.</span></span></span></div>
</div>
